{"version":3,"sources":["script.js"],"names":["ListItem","template","node","_visible","val","document","createElement","innerHTML","VirtualList","elem","listItems","itemHeight","$root","$startOffset","classList","add","appendChild","$list","$endOffset","height","offsetHeight","visibleCount","Math","ceil","from","floor","scrollTop","to","min","length","startOffset","style","endOffset","visibleListItems","slice","i","visible","append","removeChild","$virtualList","addEventListener","e","_from","flag","prepend","index","querySelector","virtualList","$input","$go","scrollTo","value","keyCode"],"mappings":"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","sourcesContent":["class ListItem {\r\n    constructor(template) {\r\n        this.template = template;\r\n        this.node = null;\r\n    }\r\n\r\n    _visible = false;\r\n    get visible() {\r\n        return this._visible;\r\n    }\r\n    set visible(val) {\r\n        this._visible = val;\r\n        if (val && !this.node) {\r\n            this.node = document.createElement('li');\r\n            this.node.innerHTML = this.template;\r\n        }\r\n    }\r\n}\r\n\r\nclass VirtualList {\r\n    constructor(elem, listItems, itemHeight) {\r\n        this.$root = elem;\r\n        this.listItems = listItems;\r\n        this.itemHeight = itemHeight;\r\n\r\n        this.$startOffset = document.createElement('div');\r\n        this.$startOffset.classList.add('start-offset');\r\n        this.$root.appendChild(this.$startOffset);\r\n        this.$list = document.createElement('ul');\r\n        this.$list.classList.add('list');\r\n        this.$root.appendChild(this.$list);\r\n        this.$endOffset = document.createElement('div');\r\n        this.$endOffset.classList.add('end-offset');\r\n        this.$root.appendChild(this.$endOffset);\r\n\r\n        this.height = this.$root.offsetHeight;\r\n        this.visibleCount = Math.ceil(this.height / this.itemHeight) + 1; // 能看到的列表项数量\r\n\r\n        this.from = Math.floor(this.$root.scrollTop / this.itemHeight); // 起始项，第一项为0\r\n        this.to = Math.min(this.from + this.visibleCount, this.listItems.length) - 1; // 结束项（包含），最大为length-1\r\n        this.startOffset = this.from * this.itemHeight + 'px'; // 前偏移，刚好为起始项索引乘单项的高度\r\n        this.$startOffset.style.height = this.startOffset;\r\n        this.endOffset = (this.listItems.length - this.to - 1) * this.itemHeight + 'px'; // 后偏移，为(总数-结束项索引-1)乘单项高度\r\n        this.$endOffset.style.height = this.endOffset;\r\n        this.visibleListItems = this.listItems.slice(this.from, this.to + 1); // slice截取数组，不包含第二个参数所指下标项，所以是结束项索引+1\r\n\r\n        for (let i = 0; i < this.listItems.length; i++) {\r\n            if (i >= this.from && i <= this.to) {\r\n                if (!this.listItems[i].visible) {\r\n                    this.listItems[i].visible = true;\r\n                    this.$list.append(this.listItems[i].node);\r\n                }\r\n            } else {\r\n                if (this.listItems[i].visible) {\r\n                    this.listItems[i].visible = false;\r\n                    this.$list.removeChild(this.listItems[i].node);\r\n                }\r\n            }\r\n        }\r\n\r\n        $virtualList.addEventListener('scroll', e => {\r\n            const _from = Math.floor($virtualList.scrollTop / this.itemHeight);\r\n            if (_from !== this.from) {\r\n                const flag = _from > this.from;\r\n                this.from = _from;\r\n                this.to = Math.min(this.from + this.visibleCount, this.listItems.length) - 1;\r\n                this.startOffset = this.from * this.itemHeight + 'px';\r\n                this.$startOffset.style.height = this.startOffset;\r\n                this.endOffset = (this.listItems.length - this.to - 1) * this.itemHeight + 'px';\r\n                this.$endOffset.style.height = this.endOffset;\r\n                this.visibleListItems = this.listItems.slice(this.from, this.to + 1);\r\n\r\n                if (flag) {\r\n                    // 向下滚动时，正序遍历，将新的节点插入到列表尾部\r\n                    for (let i = 0; i < this.listItems.length; i++) {\r\n                        if (i >= this.from && i <= this.to) {\r\n                            if (!this.listItems[i].visible) {\r\n                                this.listItems[i].visible = true;\r\n                                this.$list.append(this.listItems[i].node);\r\n                            }\r\n                        } else {\r\n                            if (this.listItems[i].visible) {\r\n                                this.listItems[i].visible = false;\r\n                                this.$list.removeChild(this.listItems[i].node);\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    // 向上滚动时，倒序遍历，将新的节点插入到列表头部\r\n                    for (let i = this.listItems.length - 1; i >= 0; i--) {\r\n                        if (i >= this.from && i <= this.to) {\r\n                            if (!this.listItems[i].visible) {\r\n                                this.listItems[i].visible = true;\r\n                                this.$list.prepend(this.listItems[i].node);\r\n                            }\r\n                        } else {\r\n                            if (this.listItems[i].visible) {\r\n                                this.listItems[i].visible = false;\r\n                                this.$list.removeChild(this.listItems[i].node);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    scrollTo(index) {\r\n        if (index < 0) {\r\n            index = 0;\r\n        }\r\n        if (index > this.listItems.length - 1) {\r\n            index = this.listItems.length - 1;\r\n        }\r\n        this.$root.scrollTop = index * this.itemHeight;\r\n    }\r\n}\r\n\r\nconst listItems = [];\r\nfor (let i = 0; i < 100000; i++) {\r\n    listItems[i] = new ListItem(`\r\n        <div class=\"container\">\r\n            <div class=\"img\"></div>\r\n            <div class=\"text\">\r\n                <input type=\"text\" placeholder=\"${i}\" />\r\n            </div>\r\n        </div>\r\n    `);\r\n}\r\n\r\nconst $virtualList = document.querySelector('.virtual-list');\r\nconst virtualList = new VirtualList($virtualList, listItems, 120);\r\n\r\nconst $input = document.querySelector('#index');\r\nconst $go = document.querySelector('.go');\r\n$go.addEventListener('click', function () {\r\n    virtualList.scrollTo($input.value);\r\n});\r\n$input.addEventListener('keyup', function (e) {\r\n    if (e.keyCode === 13) {\r\n        virtualList.scrollTo($input.value);\r\n    }\r\n});\r\n"],"file":"script.babel.js"}