{"version":3,"sources":["script.js"],"names":["Vector2D","x","y","vec","s","rad","cos","Math","sin","scale","norm","val","hypot","atan2","cvs","document","querySelector","cvsCtx","getContext","width","offsetWidth","window","devicePixelRatio","height","offsetHeight","style","transform","drawBranch","totalLength","start","end","lineWidth","strokeStyle","callback","deltaX","deltaY","length","lastTime","requestAnimationFrame","draw","Date","now","progress","beginPath","lineCap","moveTo","lineTo","stroke","drawTree","dir","bias","rotate","add","PI","random","save","restore","min"],"mappings":"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","sourcesContent":["class Vector2D {\r\n    constructor(x = 1, y = 0) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    /**\r\n     * 向量的模，向量的长度值\r\n     */\r\n    set norm(val) {}\r\n    get norm() {\r\n        return Math.hypot(this.x, this.y);\r\n    }\r\n    /**\r\n     * 方向，弧度值，向量到 x 轴正方向的角度，y 轴正方向为90度\r\n     */\r\n    set dir(val) {}\r\n    get dir() {\r\n        return Math.atan2(this.y, this.x);\r\n    }\r\n    /**\r\n     * 复制向量\r\n     */\r\n    copy() {\r\n        return new Vector2D(this.x, this.y);\r\n    }\r\n    /**\r\n     * 向量加法\r\n     * @param {Vector2D} vec 向量\r\n     */\r\n    add(vec) {\r\n        this.x += vec.x;\r\n        this.y += vec.y;\r\n        return this;\r\n    }\r\n    /**\r\n     * 向量减法\r\n     * @param {Vector2D} vec 向量\r\n     */\r\n    sub(vec) {\r\n        this.x -= vec.x;\r\n        this.y -= vec.y;\r\n        return this;\r\n    }\r\n    /**\r\n     * 点积\r\n     * @param {Vector2D} vec 向量\r\n     */\r\n    dot(vec) {\r\n        return this.x * vec.x + this.y * vec.y;\r\n    }\r\n    /**\r\n     * 叉积\r\n     * @param {Vector2D} vec 向量\r\n     */\r\n    cross(vec) {\r\n        return this.x * vec.y - this.y * vec.x;\r\n    }\r\n    /**\r\n     * 向量缩放\r\n     * @param {Number} s 缩放倍数\r\n     */\r\n    scale(s) {\r\n        this.x *= s;\r\n        this.y *= s;\r\n        return this;\r\n    }\r\n    /**\r\n     * 向量旋转，从 x 轴正方向到 y 轴正方向的旋转为正值\r\n     * @param {Number} rad 弧度\r\n     */\r\n    rotate(rad) {\r\n        const cos = Math.cos(rad);\r\n        const sin = Math.sin(rad);\r\n        const { x, y } = this;\r\n        this.x = cos * x + sin * y;\r\n        this.y = -sin * x + cos * y;\r\n        return this;\r\n    }\r\n    /**\r\n     * 化为单位向量\r\n     */\r\n    normalize() {\r\n        return this.scale(1 / this.norm);\r\n    }\r\n}\r\n\r\nconst cvs = document.querySelector('#tree'),\r\n    cvsCtx = cvs.getContext('2d');\r\n\r\ncvs.width = cvs.offsetWidth * window.devicePixelRatio;\r\ncvs.height = cvs.offsetHeight * window.devicePixelRatio;\r\ncvs.style.width = cvs.offsetWidth + 'px';\r\ncvs.style.height = cvs.offsetHeight + 'px';\r\n\r\ncvsCtx.transform(1, 0, 0, -1, cvs.width / 2, cvs.height);\r\n\r\nfunction drawBranch(cvsCtx, totalLength, start, end, lineWidth, strokeStyle, callback) {\r\n    const deltaX = end.x - start.x;\r\n    const deltaY = end.y - start.y;\r\n    let length = 0;\r\n    let lastTime = 0;\r\n\r\n    requestAnimationFrame(function draw() {\r\n        if (Date.now() - lastTime > 16) {\r\n            lastTime = Date.now();\r\n            length += 10;\r\n            length > totalLength && (length = totalLength);\r\n            const progress = length / totalLength;\r\n\r\n            cvsCtx.beginPath();\r\n            cvsCtx.strokeStyle = strokeStyle;\r\n            cvsCtx.lineWidth = lineWidth;\r\n            cvsCtx.lineCap = 'round';\r\n            cvsCtx.moveTo(start.x, start.y);\r\n            cvsCtx.lineTo(start.x + deltaX * progress, start.y + deltaY * progress);\r\n            cvsCtx.stroke();\r\n        }\r\n        if (length !== totalLength) {\r\n            requestAnimationFrame(draw);\r\n        } else {\r\n            callback();\r\n        }\r\n    });\r\n}\r\n\r\nfunction drawTree(cvsCtx, start, length, width, dir, bias) {\r\n    const end = new Vector2D().scale(length).rotate(dir).add(start);\r\n\r\n    drawBranch(cvsCtx, length, start, end, width, '#000', function () {\r\n        if (width >= 1) {\r\n            drawTree(\r\n                cvsCtx,\r\n                end,\r\n                length * 0.8,\r\n                width * 0.8,\r\n                dir + Math.PI * 0.125 + bias * (0.5 - Math.random()),\r\n                bias * 0.9\r\n            );\r\n            drawTree(\r\n                cvsCtx,\r\n                end,\r\n                length * 0.8,\r\n                width * 0.8,\r\n                dir - Math.PI * 0.125 + bias * (0.5 - Math.random()),\r\n                bias * 0.9\r\n            );\r\n        }\r\n\r\n        if (width < 5 && Math.random() < 0.2) {\r\n            cvsCtx.save();\r\n            cvsCtx.strokeStyle = '#c72c35';\r\n            cvsCtx.lineWidth = Math.random() * 10 + 3;\r\n            cvsCtx.lineCap = 'round';\r\n            cvsCtx.beginPath();\r\n            cvsCtx.moveTo(end.x, end.y - 1);\r\n            cvsCtx.lineTo(end.x, end.y + 1);\r\n            cvsCtx.stroke();\r\n            cvsCtx.restore();\r\n        }\r\n    });\r\n}\r\n\r\ndrawTree(\r\n    cvsCtx,\r\n    new Vector2D(0, 0),\r\n    Math.min(cvs.width, cvs.height) * 0.2,\r\n    Math.min(cvs.width, cvs.height) * 0.02,\r\n    Math.PI * -0.5 + (0.5 - Math.random()),\r\n    Math.PI / 3\r\n);\r\n"],"file":"script.babel.js"}