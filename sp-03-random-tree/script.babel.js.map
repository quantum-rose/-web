{"version":3,"sources":["script.js"],"names":["Vector2D","x","y","vec","s","rad","cos","Math","sin","scale","norm","val","hypot","atan2","cvs","document","querySelector","cvsCtx","getContext","width","offsetWidth","window","devicePixelRatio","height","offsetHeight","style","transform","drawBranch","totalLength","start","end","lineWidth","strokeStyle","callback","deltaX","deltaY","length","lastTime","requestAnimationFrame","draw","Date","now","progress","beginPath","lineCap","moveTo","lineTo","stroke","drawTree","dir","bias","rotate","add","PI","random","save","restore","min"],"mappings":"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","sourcesContent":["class Vector2D {\r\n    constructor(x = 1, y = 0) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    /**\r\n     * 向量的模，向量的长度值\r\n     */\r\n    set norm(val) {}\r\n    get norm() {\r\n        return Math.hypot(this.x, this.y);\r\n    }\r\n    /**\r\n     * 方向，弧度值，向量到 x 轴正方向的角度，y 轴正方向为90度\r\n     */\r\n    set dir(val) {}\r\n    get dir() {\r\n        return Math.atan2(this.y, this.x);\r\n    }\r\n    /**\r\n     * 复制向量\r\n     */\r\n    copy() {\r\n        return new Vector2D(this.x, this.y);\r\n    }\r\n    /**\r\n     * 向量加法\r\n     * @param {Vector2D} vec 向量\r\n     */\r\n    add(vec) {\r\n        this.x += vec.x;\r\n        this.y += vec.y;\r\n        return this;\r\n    }\r\n    /**\r\n     * 向量减法\r\n     * @param {Vector2D} vec 向量\r\n     */\r\n    sub(vec) {\r\n        this.x -= vec.x;\r\n        this.y -= vec.y;\r\n        return this;\r\n    }\r\n    /**\r\n     * 点积\r\n     * @param {Vector2D} vec 向量\r\n     */\r\n    dot(vec) {\r\n        return this.x * vec.x + this.y * vec.y;\r\n    }\r\n    /**\r\n     * 叉积\r\n     * @param {Vector2D} vec 向量\r\n     */\r\n    cross(vec) {\r\n        return this.x * vec.y - this.y * vec.x;\r\n    }\r\n    /**\r\n     * 向量缩放\r\n     * @param {Number} s 缩放倍数\r\n     */\r\n    scale(s) {\r\n        this.x *= s;\r\n        this.y *= s;\r\n        return this;\r\n    }\r\n    /**\r\n     * 向量旋转，从 x 轴正方向到 y 轴正方向的旋转为正值\r\n     * @param {Number} rad 弧度\r\n     */\r\n    rotate(rad) {\r\n        const cos = Math.cos(rad);\r\n        const sin = Math.sin(rad);\r\n        const { x, y } = this;\r\n        this.x = cos * x + sin * y;\r\n        this.y = -sin * x + cos * y;\r\n        return this;\r\n    }\r\n    /**\r\n     * 化为单位向量\r\n     */\r\n    normalize() {\r\n        return this.scale(1 / this.norm);\r\n    }\r\n}\r\n\r\nconst cvs = document.querySelector('#tree'),\r\n    cvsCtx = cvs.getContext('2d');\r\n\r\ncvs.width = cvs.offsetWidth * window.devicePixelRatio;\r\ncvs.height = cvs.offsetHeight * window.devicePixelRatio;\r\ncvs.style.width = cvs.offsetWidth + 'px';\r\ncvs.style.height = cvs.offsetHeight + 'px';\r\n\r\ncvsCtx.transform(1, 0, 0, -1, cvs.width / 2, cvs.height);\r\n\r\nfunction drawBranch(cvsCtx, totalLength, start, end, lineWidth, strokeStyle, callback) {\r\n    const deltaX = end.x - start.x;\r\n    const deltaY = end.y - start.y;\r\n    let length = 0;\r\n    let lastTime = 0;\r\n\r\n    requestAnimationFrame(function draw() {\r\n        if (Date.now() - lastTime > 16) {\r\n            lastTime = Date.now();\r\n            length += 10;\r\n            length > totalLength && (length = totalLength);\r\n            const progress = length / totalLength;\r\n\r\n            cvsCtx.beginPath();\r\n            cvsCtx.strokeStyle = strokeStyle;\r\n            cvsCtx.lineWidth = lineWidth;\r\n            cvsCtx.lineCap = 'round';\r\n            cvsCtx.moveTo(start.x, start.y);\r\n            cvsCtx.lineTo(start.x + deltaX * progress, start.y + deltaY * progress);\r\n            cvsCtx.stroke();\r\n        }\r\n        if (length !== totalLength) {\r\n            requestAnimationFrame(draw);\r\n        } else {\r\n            callback();\r\n        }\r\n    });\r\n}\r\n\r\nfunction drawTree(cvsCtx, start, length, width, dir, bias) {\r\n    const end = new Vector2D().scale(length).rotate(dir).add(start);\r\n\r\n    drawBranch(cvsCtx, length, start, end, width, '#000', function () {\r\n        if (width >= 1) {\r\n            drawTree(\r\n                cvsCtx,\r\n                end,\r\n                length * 0.8,\r\n                width * 0.8,\r\n                dir + Math.PI * 0.125 + bias * (0.5 - Math.random()),\r\n                bias * 0.9\r\n            );\r\n            drawTree(\r\n                cvsCtx,\r\n                end,\r\n                length * 0.8,\r\n                width * 0.8,\r\n                dir - Math.PI * 0.125 + bias * (0.5 - Math.random()),\r\n                bias * 0.9\r\n            );\r\n        }\r\n\r\n        if (width < 5 && Math.random() < 0.2) {\r\n            cvsCtx.save();\r\n            cvsCtx.strokeStyle = '#c72c35';\r\n            cvsCtx.lineWidth = Math.random() * 10 + 3;\r\n            cvsCtx.lineCap = 'round';\r\n            cvsCtx.beginPath();\r\n            cvsCtx.moveTo(end.x, end.y - 1);\r\n            cvsCtx.lineTo(end.x, end.y + 1);\r\n            cvsCtx.stroke();\r\n            cvsCtx.restore();\r\n        }\r\n    });\r\n}\r\n\r\ndrawTree(\r\n    cvsCtx,\r\n    new Vector2D(0, 0),\r\n    Math.min(cvs.width, cvs.height) * 0.2,\r\n    Math.min(cvs.width, cvs.height) * 0.02,\r\n    Math.PI * -0.5 + (0.5 - Math.random()),\r\n    Math.PI / 3\r\n);\r\n"],"file":"script.babel.js"}