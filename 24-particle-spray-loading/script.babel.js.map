{"version":3,"sources":["script.js"],"names":["$cvs","document","querySelector","Particle","cvsCtx","x","y","vx","vy","ax","ay","color","lifetime","Math","random","join","t","r","duration","alpha","min","beginPath","fillStyle","arc","PI","fill","closePath","ParticleLoading","width","height","h","w","v","percent","lastPercent","Date","now","lastTime","clearRect","fillRect","f","createLinearGradient","addColorStop","particles","filter","item","render","i","rad","push","cos","sin","_color","requestAnimationFrame","_onEnterFrame","cvs","getContext","offsetWidth","window","devicePixelRatio","offsetHeight","_init","addEventListener","p","g","b","loading","hidden","pause","speed","draw","update","e","setTimeout","$range","$number","innerText","value","toFixed"],"mappings":"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","sourcesContent":["const $cvs = document.querySelector('#cvs');\r\n\r\n/* 粒子 */\r\nclass Particle {\r\n    cvsCtx = null;\r\n    r = Math.random() + 0.75;\r\n    x = 0; // 横坐标\r\n    y = 0; // 纵坐标\r\n    vx = 0; // 水平速度\r\n    vy = 0; // 垂直速度\r\n    ax = 0; // 水平加速度\r\n    ay = 0; // 垂直加速度\r\n    color = '';\r\n    lifetime = 1;\r\n    duration = 0;\r\n    alpha = 1;\r\n\r\n    constructor({ cvsCtx, x, y, vx, vy, ax, ay, color, lifetime = 1 }) {\r\n        this.cvsCtx = cvsCtx;\r\n        this.x = x;\r\n        this.y = y;\r\n        this.vx = vx;\r\n        this.vy = vy;\r\n        this.ax = ax;\r\n        this.ay = ay;\r\n        this.color = color.join(',');\r\n        this.lifetime = lifetime;\r\n    }\r\n\r\n    render(t) {\r\n        const { cvsCtx, r, vx, vy, ax, ay, color, lifetime } = this;\r\n        this.duration += t;\r\n        this.alpha = (1 - Math.min(this.duration / lifetime, 1)) ** 0.5;\r\n        this.vx += ax * t;\r\n        this.vy += ay * t;\r\n        this.x += vx * t;\r\n        this.y += vy * t;\r\n        cvsCtx.beginPath();\r\n        cvsCtx.fillStyle = `rgba(${color},${this.alpha})`;\r\n        cvsCtx.arc(this.x, this.y, r, 0, Math.PI * 2, false);\r\n        cvsCtx.fill();\r\n        cvsCtx.closePath();\r\n    }\r\n}\r\n\r\nclass ParticleLoading {\r\n    cvs = null;\r\n    cvsCtx = null;\r\n    width = 0;\r\n    height = 0;\r\n    lastTime = 0;\r\n    lastPercent = 0;\r\n    percent = 0;\r\n    particles = [];\r\n\r\n    get v() {\r\n        return this.width / 4;\r\n    }\r\n    get w() {\r\n        return this.width * 0.8;\r\n    }\r\n    get h() {\r\n        return this.width * 0.04;\r\n    }\r\n    get x() {\r\n        return this.width * 0.1;\r\n    }\r\n    get y() {\r\n        return (this.height - this.h) * 0.5;\r\n    }\r\n\r\n    constructor() {\r\n        this.cvs = cvs;\r\n        this.cvsCtx = cvs.getContext('2d');\r\n        this.width = this.cvs.width = cvs.offsetWidth * window.devicePixelRatio;\r\n        this.height = this.cvs.height = cvs.offsetHeight * window.devicePixelRatio;\r\n        this.lastTime = Date.now();\r\n        this._init();\r\n        this._onEnterFrame();\r\n    }\r\n\r\n    update(percent) {\r\n        this.lastPercent = this.percent;\r\n        this.percent = percent;\r\n    }\r\n\r\n    _init() {\r\n        window.addEventListener('resize', () => {\r\n            this.width = this.cvs.width = cvs.offsetWidth * window.devicePixelRatio;\r\n            this.height = this.cvs.height = cvs.offsetHeight * window.devicePixelRatio;\r\n        });\r\n    }\r\n\r\n    _onEnterFrame = () => {\r\n        const { cvsCtx, width, height, w, h, x, y, v, percent, lastPercent } = this;\r\n        const t = (Date.now() - this.lastTime) / 1000;\r\n        this.lastTime = Date.now();\r\n\r\n        cvsCtx.clearRect(0, 0, width, height);\r\n        cvsCtx.fillStyle = '#000000';\r\n        cvsCtx.fillRect(0, 0, width, height);\r\n        cvsCtx.fillStyle = '#333333';\r\n        cvsCtx.fillRect(x, y, w, h);\r\n        const f = cvsCtx.createLinearGradient(x, y, x + w, y);\r\n        f.addColorStop(0, 'rgba(255,0,0,1)');\r\n        f.addColorStop(0.25, 'rgba(255,255,0,1');\r\n        f.addColorStop(0.5, 'rgba(0,255,0,1');\r\n        f.addColorStop(0.75, 'rgba(0,255,255,1');\r\n        f.addColorStop(1, 'rgba(0,0,255,1');\r\n        cvsCtx.fillStyle = f;\r\n        cvsCtx.fillRect(x, y, w * percent, h);\r\n\r\n        this.particles = this.particles.filter(item => (item.render(t), item.alpha > 0));\r\n        for (let i = 0; i < (percent - lastPercent) * 5 * width; i++) {\r\n            const rad = (Math.random() / 3 - 1) * Math.PI;\r\n            this.particles.push(\r\n                new Particle({\r\n                    cvsCtx,\r\n                    x: x + w * percent + 2 - Math.random() * 4,\r\n                    y: y + Math.random() * h * 0.5,\r\n                    vx: Math.cos(rad) * v * (0.5 + Math.random()),\r\n                    vy: Math.sin(rad) * v,\r\n                    ax: 0,\r\n                    ay: v * 1.5,\r\n                    color: this._color(percent),\r\n                })\r\n            );\r\n        }\r\n\r\n        requestAnimationFrame(this._onEnterFrame);\r\n    };\r\n\r\n    _color(p) {\r\n        let r, g, b;\r\n        if (p < 0.25) {\r\n            r = 255;\r\n            g = 255 * (p / 0.25);\r\n            b = 0;\r\n        } else if (p < 0.5) {\r\n            r = 255 * (1 - (p - 0.25) / 0.25);\r\n            g = 255;\r\n            b = 0;\r\n        } else if (p < 0.75) {\r\n            r = 0;\r\n            g = 255;\r\n            b = 255 * ((p - 0.5) / 0.25);\r\n        } else {\r\n            r = 0;\r\n            g = 255 * (1 - (p - 0.75) / 0.25);\r\n            b = 255;\r\n        }\r\n        return [r, g, b];\r\n    }\r\n}\r\n\r\nconst loading = new ParticleLoading(cvs);\r\nlet lastTime = Date.now();\r\nlet percent = 0;\r\nlet hidden = false;\r\nlet pause = false;\r\nlet speed = 0.0001;\r\nrequestAnimationFrame(function draw() {\r\n    const t = Date.now() - lastTime;\r\n    if (!hidden && !pause) {\r\n        percent = (percent + speed * t) % 1;\r\n    }\r\n    loading.update(percent);\r\n    lastTime += t;\r\n    requestAnimationFrame(draw);\r\n});\r\n\r\ndocument.addEventListener('visibilitychange', e => {\r\n    setTimeout(() => {\r\n        hidden = document.hidden;\r\n    }, 0);\r\n});\r\n$cvs.addEventListener('click', e => {\r\n    pause = !pause;\r\n});\r\n\r\nconst $range = document.querySelector('#range');\r\nconst $number = document.querySelector('#number');\r\n$range.addEventListener('input', function (e) {\r\n    $number.innerText = (this.value - 0).toFixed(2) + '% / s';\r\n    speed = this.value / 100000;\r\n});\r\n"],"file":"script.babel.js"}