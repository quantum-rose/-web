{"version":3,"sources":["script.js"],"names":["ListItem","template","node","_visible","val","document","createElement","innerHTML","VirtualList","elem","listItems","itemHeight","$root","$startOffset","classList","add","appendChild","$list","$endOffset","height","offsetHeight","visibleCount","Math","ceil","from","floor","scrollTop","to","min","length","startOffset","style","endOffset","visibleListItems","slice","i","visible","append","removeChild","$virtualList","addEventListener","e","_from","flag","prepend","index","querySelector","virtualList","$input","$go","scrollTo","value","keyCode"],"mappings":"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","sourcesContent":["class ListItem {\r\n    constructor(template) {\r\n        this.template = template;\r\n        this.node = null;\r\n    }\r\n\r\n    _visible = false;\r\n    get visible() {\r\n        return this._visible;\r\n    }\r\n    set visible(val) {\r\n        this._visible = val;\r\n        if (val && !this.node) {\r\n            this.node = document.createElement('li');\r\n            this.node.innerHTML = this.template;\r\n        }\r\n    }\r\n}\r\n\r\nclass VirtualList {\r\n    constructor(elem, listItems, itemHeight) {\r\n        this.$root = elem;\r\n        this.listItems = listItems;\r\n        this.itemHeight = itemHeight;\r\n\r\n        this.$startOffset = document.createElement('div');\r\n        this.$startOffset.classList.add('start-offset');\r\n        this.$root.appendChild(this.$startOffset);\r\n        this.$list = document.createElement('ul');\r\n        this.$list.classList.add('list');\r\n        this.$root.appendChild(this.$list);\r\n        this.$endOffset = document.createElement('div');\r\n        this.$endOffset.classList.add('end-offset');\r\n        this.$root.appendChild(this.$endOffset);\r\n\r\n        this.height = this.$root.offsetHeight;\r\n        this.visibleCount = Math.ceil(this.height / this.itemHeight) + 1; // 能看到的列表项数量\r\n\r\n        this.from = Math.floor(this.$root.scrollTop / this.itemHeight); // 起始项，第一项为0\r\n        this.to = Math.min(this.from + this.visibleCount, this.listItems.length) - 1; // 结束项（包含），最大为length-1\r\n        this.startOffset = this.from * this.itemHeight + 'px'; // 前偏移，刚好为起始项索引乘单项的高度\r\n        this.$startOffset.style.height = this.startOffset;\r\n        this.endOffset = (this.listItems.length - this.to - 1) * this.itemHeight + 'px'; // 后偏移，为(总数-结束项索引-1)乘单项高度\r\n        this.$endOffset.style.height = this.endOffset;\r\n        this.visibleListItems = this.listItems.slice(this.from, this.to + 1); // slice截取数组，不包含第二个参数所指下标项，所以是结束项索引+1\r\n\r\n        for (let i = 0; i < this.listItems.length; i++) {\r\n            if (i >= this.from && i <= this.to) {\r\n                if (!this.listItems[i].visible) {\r\n                    this.listItems[i].visible = true;\r\n                    this.$list.append(this.listItems[i].node);\r\n                }\r\n            } else {\r\n                if (this.listItems[i].visible) {\r\n                    this.listItems[i].visible = false;\r\n                    this.$list.removeChild(this.listItems[i].node);\r\n                }\r\n            }\r\n        }\r\n\r\n        $virtualList.addEventListener('scroll', e => {\r\n            const _from = Math.floor($virtualList.scrollTop / this.itemHeight);\r\n            if (_from !== this.from) {\r\n                const flag = _from > this.from;\r\n                this.from = _from;\r\n                this.to = Math.min(this.from + this.visibleCount, this.listItems.length) - 1;\r\n                this.startOffset = this.from * this.itemHeight + 'px';\r\n                this.$startOffset.style.height = this.startOffset;\r\n                this.endOffset = (this.listItems.length - this.to - 1) * this.itemHeight + 'px';\r\n                this.$endOffset.style.height = this.endOffset;\r\n                this.visibleListItems = this.listItems.slice(this.from, this.to + 1);\r\n\r\n                if (flag) {\r\n                    // 向下滚动时，正序遍历，将新的节点插入到列表尾部\r\n                    for (let i = 0; i < this.listItems.length; i++) {\r\n                        if (i >= this.from && i <= this.to) {\r\n                            if (!this.listItems[i].visible) {\r\n                                this.listItems[i].visible = true;\r\n                                this.$list.append(this.listItems[i].node);\r\n                            }\r\n                        } else {\r\n                            if (this.listItems[i].visible) {\r\n                                this.listItems[i].visible = false;\r\n                                this.$list.removeChild(this.listItems[i].node);\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    // 向上滚动时，倒序遍历，将新的节点插入到列表头部\r\n                    for (let i = this.listItems.length - 1; i >= 0; i--) {\r\n                        if (i >= this.from && i <= this.to) {\r\n                            if (!this.listItems[i].visible) {\r\n                                this.listItems[i].visible = true;\r\n                                this.$list.prepend(this.listItems[i].node);\r\n                            }\r\n                        } else {\r\n                            if (this.listItems[i].visible) {\r\n                                this.listItems[i].visible = false;\r\n                                this.$list.removeChild(this.listItems[i].node);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    scrollTo(index) {\r\n        if (index < 0) {\r\n            index = 0;\r\n        }\r\n        if (index > this.listItems.length - 1) {\r\n            index = this.listItems.length - 1;\r\n        }\r\n        this.$root.scrollTop = index * this.itemHeight;\r\n    }\r\n}\r\n\r\nconst listItems = [];\r\nfor (let i = 0; i < 100000; i++) {\r\n    listItems[i] = new ListItem(`\r\n        <div class=\"container\">\r\n            <div class=\"img\"></div>\r\n            <div class=\"text\">\r\n                <input type=\"text\" placeholder=\"${i}\" />\r\n            </div>\r\n        </div>\r\n    `);\r\n}\r\n\r\nconst $virtualList = document.querySelector('.virtual-list');\r\nconst virtualList = new VirtualList($virtualList, listItems, 120);\r\n\r\nconst $input = document.querySelector('#index');\r\nconst $go = document.querySelector('.go');\r\n$go.addEventListener('click', function () {\r\n    virtualList.scrollTo($input.value);\r\n});\r\n$input.addEventListener('keyup', function (e) {\r\n    if (e.keyCode === 13) {\r\n        virtualList.scrollTo($input.value);\r\n    }\r\n});\r\n"],"file":"script.babel.js"}