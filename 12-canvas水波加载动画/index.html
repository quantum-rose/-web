<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>canvas水波加载动画</title>
        <style>
            * {
                margin: 0;
                padding: 0;
            }

            html,
            body {
                width: 100%;
                height: 100%;
                touch-action: none;
            }

            body {
                display: flex;
                background-image: linear-gradient(25deg, #24305a, #3e6270, #519885, #5fd29a);
            }

            #wave {
                margin: auto;
                width: 60vmin;
                height: 60vmin;
            }
        </style>
    </head>

    <body>
        <canvas id="wave"></canvas>

        <!-- <script src="https://cdn.staticfile.org/vConsole/3.3.4/vconsole.min.js"></script>
        <script>
            new VConsole();
        </script> -->

        <script>
            const $canvas = document.getElementById('wave'),
                cvsCtx = $canvas.getContext('2d'),
                PI_1_2 = Math.PI / 2,
                PI_2 = Math.PI * 2;

            let cvsSize = $canvas.offsetWidth * window.devicePixelRatio,
                cvsHalfSize = cvsSize / 2,
                outlineWidth = cvsSize / 20,
                circleRadius = cvsHalfSize - outlineWidth / 2,
                A = circleRadius / 6, // 振幅，最大为半径的六分之一
                ω = Math.PI / circleRadius, // 角速度，此时周期为2R，在圆内最宽处刚好显示一个完整的周期
                φ = Math.PI * 16, // 相位，从0加载到100%的过程中，波形向左平移16π，即8个周期
                percent = 0;

            $canvas.width = $canvas.height = cvsSize;

            draw();

            function draw() {
                cvsCtx.clearRect(0, 0, cvsSize, cvsSize);
                percent > 1 && (percent = 0);
                percent += 0.005;
                renderWave(percent);
                renderOutline(percent);
                renderText(percent);
                requestAnimationFrame(draw);
            }

            function renderOutline(percent) {
                cvsCtx.save();
                cvsCtx.beginPath();
                cvsCtx.arc(cvsHalfSize, cvsHalfSize, circleRadius, -PI_1_2, PI_2 * percent - PI_1_2, false);
                cvsCtx.strokeStyle = '#70dfc0';
                cvsCtx.lineWidth = outlineWidth;
                cvsCtx.stroke();
                cvsCtx.restore();
            }

            function renderWave(percent) {
                cvsCtx.save();
                setCircleClip();
                drawWave(percent, percent * φ);
                // drawWave(1 - percent, -percent * φ)
                cvsCtx.restore();
            }

            function setCircleClip() {
                cvsCtx.beginPath();
                cvsCtx.arc(cvsHalfSize, cvsHalfSize, cvsHalfSize - outlineWidth, 0, PI_2, false);
                cvsCtx.clip();
            }

            function drawWave(percent, fi) {
                let p = 1 - percent
                cvsCtx.beginPath();
                cvsCtx.moveTo(0, p ** 0.5 * A * Math.sin(fi) + p * cvsSize);
                for (let i = 1; i <= cvsSize; i++) {
                    cvsCtx.lineTo(i, p ** 0.5 * A * Math.sin(ω * i + fi) + p * cvsSize);
                }
                cvsCtx.lineTo(cvsSize, cvsSize);
                cvsCtx.lineTo(0, cvsSize);
                cvsCtx.strokeStyle = 'rgba(0,0,0,0)';
                cvsCtx.lineWidth = 0;
                cvsCtx.stroke();
                cvsCtx.closePath();
                let fill = cvsCtx.createLinearGradient(0, 0, 0, cvsSize);
                fill.addColorStop(0, 'rgba(10, 12, 32, 0.5)');
                fill.addColorStop(0.5, `rgba(${44 - percent * 34}, ${75 - percent * 63}, ${80 - percent * 48}, 0.5)`);
                fill.addColorStop(1, `rgba(${77 - percent * 67}, ${146 - percent * 134}, ${134 - percent * 102}, 0.5)`);
                cvsCtx.fillStyle = fill;
                cvsCtx.fill();
            }

            function renderText(percent) {
                cvsCtx.fillText(Math.floor(percent * 100) + '%', cvsHalfSize, cvsHalfSize);
                cvsCtx.fillStyle = '#70dfc0';
                cvsCtx.textAlign = 'center';
                cvsCtx.textBaseline = 'middle';
                cvsCtx.font = cvsSize / 8 + 'px impact';
            }

            window.onresize = function () {
                cvsSize = $canvas.offsetWidth;
                cvsHalfSize = cvsSize / 2;
                outlineWidth = cvsSize / 20;
                circleRadius = cvsHalfSize - outlineWidth / 2;
                A = circleRadius / 6;
                ω = PI_2 / cvsSize;
                $canvas.width = $canvas.height = cvsSize;
            };
        </script>
    </body>

</html>